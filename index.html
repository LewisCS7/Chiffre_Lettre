<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Convertisseur – Nombres en lettres</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- PWA manifest + favicon -->
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" href="icon-192.png" type="image/png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <!-- <meta name="theme-color" content="#0ea5e9"> -->
    <link rel="stylesheet" href="style.css">
    <!-- Tailwind CSS v4 CDN (alpha build) -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen flex items-center justify-center p-0 font-sans relative overflow-hidden">
    <div class="fixed inset-0 -z-10">
      <img src="background.jpg" alt="background" class="w-full h-full" />
      <div class="absolute inset-0 bg-gradient-to-br from-blue-100/40 via-sky-200/60 to-emerald-200/40"></div>
    </div>
    <div class="w-full max-w-lg min-h-[70vh] sm:min-h-[80vh] flex flex-col justify-center bg-white backdrop-blur-md rounded-3xl shadow-2xl px-2 sm:px-8 py-6 sm:py-12 space-y-8 border-2 border-blue-300 mx-auto my-6 sm:my-10">
      <h1 class="text-3xl sm:text-5xl font-extrabold text-center bg-gradient-to-r from-indigo-500 via-sky-500 to-emerald-400 bg-clip-text text-transparent drop-shadow-lg tracking-tight">
        CONVERTISSEUR
      </h1>
      <p class="text-center text-slate-500 text-base sm:text-lg mb-2">
        Nombres → Lettres
      </p>

      <input
        id="numberInput"
        type="text"
        inputmode="decimal"
        class="w-full px-4 sm:px-6 py-4 sm:py-6 border-2 border-emerald-300 rounded-2xl focus:ring-4 focus:ring-emerald-300 focus:border-emerald-500 transition text-3xl sm:text-4xl font-mono tracking-wider bg-white/90 placeholder-slate-200 shadow-lg outline-none text-slate-800 text-center input-numeric"
        placeholder="Ex: 1234,56"
        autocomplete="off"
        inputmode="decimal"
        aria-label="Nombre à convertir"
      />

      <div class="relative mt-6">
        <div class="bg-gradient-to-br from-white/90 via-sky-50 to-emerald-50 rounded-2xl shadow-inner border border-slate-100">
          <div class="flex items-center justify-between px-4 pt-4">
            <span class="font-semibold text-slate-700 text-base sm:text-lg select-none">Résultat :</span>
            <div class="flex gap-1">
              <button
                id="copyBtn"
                class="p-1.5 rounded-full border border-slate-200 bg-white/80 hover:bg-emerald-100 shadow transition focus:outline-none focus:ring-2 focus:ring-emerald-400 disabled:opacity-40 disabled:cursor-not-allowed btn-copy"
                type="button"
                aria-label="Copier le résultat"
                title="Copier le résultat"
              >
                <svg id="copyIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                  <rect x="5" y="3" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
              </button>
              <button
                id="speakBtn"
                class="p-1.5 rounded-full border border-slate-200 bg-white/80 hover:bg-blue-100 shadow transition focus:outline-none focus:ring-2 focus:ring-blue-400 disabled:opacity-40 disabled:cursor-not-allowed btn-speak"
                type="button"
                aria-label="Lire le résultat à voix haute"
                title="Lire le résultat à voix haute"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path d="M11 5L6 9H2v6h4l5 4V5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                  <path d="M19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                </svg>
              </button>
            </div>
          </div>
          <div id="result" class="px-4 pb-4 pt-2 sm:px-6 sm:pb-6 sm:pt-3 text-slate-900 text-lg sm:text-2xl leading-relaxed break-words min-h-[3rem] sm:min-h-[4rem] text-center select-all transition-all duration-200">
            …
          </div>
        </div>
      </div>
    </div>

    <!-- Simple JS converter (covers integers & 2-decimals) -->
    <script>
      // Liste des mots de base
      const UNITS = ['zéro', 'un', 'deux', 'trois', 'quatre', 'cinq', 'six', 'sept', 'huit', 'neuf'];
      const TEENS  = ['dix', 'onze', 'douze', 'treize', 'quatorze', 'quinze', 'seize', 'dix-sept', 'dix-huit', 'dix-neuf'];
      const TENS   = ['', '', 'vingt', 'trente', 'quarante', 'cinquante', 'soixante', 'soixante', 'quatre-vingt', 'quatre-vingt'];

      // Convertit un nombre entier 0-999
      function convertLessThan1000(n) {
        if (n < 10) return UNITS[n];
        if (n < 20) return TEENS[n - 10];
        if (n < 100) {
          let t = Math.floor(n / 10);
          let u = n % 10;
          // Gestion des "et un" (21, 31, 41, 51, 61, 71)
          if ((t === 2 || t === 3 || t === 4 || t === 5 || t === 6) && u === 1) {
            return TENS[t] + ' et un';
          }
          // 71, 81, 91
          if (t === 7 && u === 1) return 'soixante et onze';
          if (t === 9 && u === 1) return 'quatre-vingt-onze';
          // 70-79, 90-99
          if (t === 7) return 'soixante-' + TEENS[u];
          if (t === 9) return 'quatre-vingt-' + TEENS[u];
          // 80
          if (t === 8 && u === 0) return 'quatre-vingts';
          // 81, 91
          if (t === 8 && u === 1) return 'quatre-vingt-un';
          if (t === 8) return 'quatre-vingt-' + UNITS[u];
          return TENS[t] + (u ? '-' + UNITS[u] : '');
        }
        let h = Math.floor(n / 100);
        let rest = n % 100;
        let hundred = '';
        if (h === 1) {
          hundred = 'cent';
        } else {
          hundred = UNITS[h] + ' cent';
        }
        // Accord de "cent" : prend un "s" seulement si pas suivi d'autre nombre
        if (rest === 0 && h > 1) hundred += 's';
        if (rest === 0) return hundred;
        return hundred + ' ' + convertLessThan1000(rest);
      }

      // Convertit n'importe quel nombre entier
      function integerToWords(n) {
        if (n === 0) return 'zéro';
        // Échelles étendues jusqu'à décillion
        const scales = [
          '', 'mille', 'million', 'milliard', 'billion', 'billiard',
          'trillion', 'trilliard', 'quadrillion', 'quadrilliard',
          'quintillion', 'quintilliard', 'sextillion', 'sextilliard',
          'septillion', 'septilliard', 'octillion', 'octilliard',
          'nonillion', 'nonilliard', 'décillion', 'décilliard'
        ];
        let parts = [];
        let scaleIndex = 0;
        while (n > 0) {
          let chunk = n % 1000;
          if (chunk) {
            let chunkWords = convertLessThan1000(chunk);
            // "un mille" -> "mille"
            if (scaleIndex === 1 && chunk === 1) {
              chunkWords = 'mille';
            }
            // Pluriels pour million, milliard, etc.
            if (scaleIndex > 1) {
              chunkWords += ' ' + scales[scaleIndex];
              if (chunk > 1) chunkWords += 's';
            } else if (scaleIndex === 1 && chunk > 1) {
              chunkWords += ' ' + scales[scaleIndex];
            }
            parts.unshift(chunkWords);
          }
          n = Math.floor(n / 1000);
          scaleIndex++;
        }
        return parts.join(' ');
      }

      // Fonction d'affichage dynamique du résultat
      function updateResult() {
        const val = document.getElementById('numberInput').value.trim().replace(',', '.');
        const resultDiv = document.getElementById('result');
        const copyBtn = document.getElementById('copyBtn');
        const speakBtn = document.getElementById('speakBtn');
        // Par défaut, masquer l'icône copie et désactiver le bouton vocal
        copyBtn.classList.add('btn-copy');
        speakBtn.classList.add('btn-speak');
        speakBtn.disabled = true;
        speakBtn.classList.remove('animate-pulse');
        if (!val) {
          resultDiv.textContent = 'Le résultat apparaîtra ici…';
          return;
        }
        if (!/^-?\d+(\.\d{1,2})?$/.test(val)) {
          resultDiv.textContent = 'Veuillez saisir un nombre valide.';
          return;
        }
        const num = parseFloat(val);
        if (num === 0) {
          resultDiv.textContent = 'zéro';
          copyBtn.classList.remove('btn-copy');
          speakBtn.classList.remove('btn-speak');
          speakBtn.disabled = false;
          return;
        }

        const sign = num < 0 ? 'moins ' : '';
        const parts = Math.abs(num).toFixed(2).split('.');
        const intPart = integerToWords(parseInt(parts[0]));
        let result = sign + intPart;
        if (parts[1] && parts[1] !== '00') {
          result += ' virgule ' + parts[1].split('').map(d => UNITS[parseInt(d)]).join(' ');
        }
        resultDiv.textContent = result;
        // Afficher les boutons seulement si un vrai résultat
        copyBtn.classList.remove('btn-copy');
        speakBtn.classList.remove('btn-speak');
        speakBtn.disabled = false;
      }

      // Affichage dynamique lors de la saisie
      document.getElementById('numberInput').addEventListener('input', updateResult);

      // Gestion de la copie via l'icône
      document.getElementById('copyBtn').addEventListener('click', () => {
        const resultText = document.getElementById('result').textContent;
        if (resultText && resultText.trim() !== '' && resultText !== 'Le résultat apparaîtra ici…') {
          navigator.clipboard.writeText(resultText).then(() => {
            const icon = document.getElementById('copyIcon');
            icon.classList.remove('text-emerald-500');
            icon.classList.add('text-green-600');
            icon.innerHTML = '<path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />';
            setTimeout(() => {
              icon.className = 'h-6 w-6 text-emerald-500';
              icon.innerHTML = '<rect x="9" y="9" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><rect x="5" y="3" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>';
            }, 1200);
          });
        }
      });

      // Lecture vocale du résultat
      const speakBtn = document.getElementById('speakBtn');
      let utterance = null;
      let isSpeaking = false;
      speakBtn.addEventListener('click', () => {
        const resultText = document.getElementById('result').textContent;
        if (!resultText || resultText.trim() === '' || resultText === 'Le résultat apparaîtra ici…' || speakBtn.disabled) return;
        if (!('speechSynthesis' in window)) {
          alert('La synthèse vocale n\'est pas supportée sur ce navigateur.');
          return;
        }
        speakBtn.disabled = true;
        speakBtn.classList.add('animate-pulse', 'opacity-60');
        isSpeaking = true;
        utterance = new window.SpeechSynthesisUtterance(resultText);
        utterance.lang = 'fr-FR';
        utterance.rate = 1;
        utterance.onend = utterance.onerror = () => {
          speakBtn.disabled = false;
          speakBtn.classList.remove('animate-pulse', 'opacity-60');
          isSpeaking = false;
        };
        window.speechSynthesis.speak(utterance);
      });
    // --- Tests unitaires simples ---
    function runTests() {
      const tests = [
        [0, 'zéro'],
        [1, 'un'],
        [11, 'onze'],
        [21, 'vingt et un'],
        [71, 'soixante et onze'],
        [80, 'quatre-vingts'],
        [81, 'quatre-vingt-un'],
        [100, 'cent'],
        [101, 'cent un'],
        [200, 'deux cents'],
        [201, 'deux cent un'],
        [1000, 'mille'],
        [2000, 'deux mille'],
        [1000000, 'un million'],
        [2000000, 'deux millions'],
        [1000000000, 'un milliard'],
        [2000000000, 'deux milliards'],
        [1000000000000, 'un billion'],
        [2000000000000, 'deux billions'],
        [1000000000000000, 'un billiard'],
        [1000000000000000000, 'un trillion'],
        [1000000000000000000000, 'un trilliard'],
        [1000000000000000000000000, 'un quadrillion'],
        [1000000000000000000000000000, 'un quadrilliard'],
        [1000000000000000000000000000000, 'un quintillion'],
        [1000000000000000000000000000000000, 'un quintilliard'],
      ];
      let ok = 0, fail = 0;
      for (const [input, expected] of tests) {
        const got = integerToWords(input);
        if (got === expected) {
          ok++;
        } else {
          fail++;
          console.error(`Test raté: ${input} → ${got} (attendu: ${expected})`);
        }
      }
      console.log(`Tests passés: ${ok} réussis, ${fail} échecs.`);
    }
    // Décommentez la ligne suivante pour lancer les tests dans la console:
    // runTests();
    </script>

    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js');
      }
    </script>

  </body>
</html>